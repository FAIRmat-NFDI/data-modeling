<?xml version='1.0' encoding='UTF-8'?>
<?xml-stylesheet type="text/xsl" href="nxdlformat.xsl"?>
<definition xmlns="http://definition.nexusformat.org/nxdl/3.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://definition.nexusformat.org/nxdl/nxdl.xsd" category="application" name="NXem_base_draft" type="NXobject" doc="draft set of components for application definitions for electron microscopy, here exemplified with scanning nanobeam diffraction in transmission electron microscopes in mind">
  <symbols doc="The symbols used in the schema to specify e.g. dimensions of arrays">
    <sym name="imageid" doc="Frame or given number to distinguish different images in a stack"/>
    <sym name="ypos" doc="Pixel coordinate in the slow-changing direction"/>
    <sym name="xpos" doc="Pixel coordinate in the fast-changing direction"/>
    <sym name="nimages" doc="Total of images in the imagestack"/>
    <sym name="ny" doc="Pixel counts in the slow-changing direction"/>
    <sym name="nx" doc="Pixel counts in the fast-changing direction"/>
  </symbols>
  <group type="NXentry" required="true">
    <field name="experiment_identifier" doc="Unique identifier of the experiment, such as a (globally persistent) unique identifier. The identifier is usually defined by the facility or principle investigator. The identifier enables to link experiments to e.g. proposals."/>
    <field name="experiment_description"/>
    <field name="start_time" type="NX_DATE_TIME" units="NX_TIME"/>
    <field name="end_time" type="NX_DATE_TIME" units="NX_TIME"/>
    <field name="duration" type="NX_INT" units="NX_TIME"/>
    <field name="collection_time" type="NX_INT" units="NX_TIME"/>
    <field name="program_name" doc="Commercial or otherwise defined given name to the program that was used to generate the results files with measurements and metadata."/>
    <field name="program_version" doc="Either version with build number, commit hash, or description of a (online) repository where the source code of the program and build instructions can be found so that the program can be configured in such a way that result files can be created ideally in a deterministic manner."/>
    <group type="NXsubentry">
      <field name="definition_local" doc="FAIRmat-specific candidate proposal for an application definition exemplifying for scanning nanobeam diffraction">
        <field name="version" doc="Ideally version with build number are commit hash of the application definition. If not available a free-text description."/>
        <field name="url" doc="URL where to find further material (documentation, examples) relevant to the application definition"/>
      </field>
    </group>
    <group type="NXuser" minOccurs="1" doc="Contact information of at least the user of the instrument or the principal investigator who created the file. Adding multiple users is recommended.">
      <field name="name"/>
      <field name="affiliation" doc="Name of the affiliation of the user at the point in time when the experiment was performed."/>
      <field name="address"/>
      <field name="email"/>
      <field name="orcid"/>
      <field name="telephone_number"/>
    </group>
    <group type="NXsample" minOccurs="1">
      <field name="name"/>
      <field name="sample_history" doc="Ideally, a reference to the location or a unique (globally persistent) identifier (e.g.) of e.g. another file which gives as many as possible details of the material, its microstructure, and its thermo-chemo-mechanical processing/preparation history. In the case that such a detailed history of the sample is not available, use this field as a free-text description to specify details of the sample and its preparation."/>
      <field name="preparation_date" type="NX_DATE_TIME" units="NX_TIME"/>
      <field name="description"/>
      <field name="short_title"/>
      <field name="temperature" type="NX_FLOAT" units="NX_TEMPERATURE"/>
      <field name="atom_types" required="true" doc="Use Hill's system for listing elements of the periodic table which are inside or attached to the surface of the specimen and thus relevant from a scientific point. The purpose of this field is to allow materials database to parse the relevant elements without having to interpret the sample history."/>
    </group>
    <group type="NXdata" doc="Hard link to a location in the hierarchy of the NeXus file where the data are stored">
      <field name="link"/>
    </group>
    <group type="NXprocess">
      <field name="program_name" doc="Commercial or otherwise defined given name to the program that was used to process the data on-the-fly."/>
      <field name="program_version" doc="Either version with build number, commit hash, or description of a (online) repository where the source code of the program and build instructions can be found so that the program can be configured in such a way that result files can be created ideally in a deterministic manner."/>
      <field name="description" doc="Ideally, a reference to the location or a unique (globally persistent) identifier (e.g.) of e.g. another file which gives as many as possible details of this processing steps. In the case that such a detailed history of the processing (steps) is not available, use this field as a free-text description of this processing."/>
      <group type="NXcollection">
        <field name="cartesian_scan_dimensions" type="NX_UINT" doc="to be defined I need to double check with Christoph Koch what this is, but I think the member names for this and the next two members are not nice. I consider these three more like a dummy like the WONI experiment to understand how to store n-dimensional data using NeXus."/>
        <field name="cartesian_scan_dimension_1_count" type="NX_UINT" doc="to be defined"/>
        <field name="cartesian_scan_dimension_2_count" type="NX_UINT" doc="to be defined"/>
        <group type="NXdata" doc="A stack of two-dimensional images with imageid changing slowest, ypos changing faster, and xpos changing fastest, i.e. xpos + ypos * nx + imageid * nx*ny implicit C-style indexing.">
          <attribute name="signal"/>
          <attribute name="axes"/>
          <attribute name="imageid_indices"/>
          <attribute name="ypos_indices"/>
          <attribute name="xpos_indices"/>
          <field name="data" type="NX_FLOAT">
            <dimensions rank="3">
              <dim index="2" value="nimages"/>
              <dim index="1" value="ny"/>
              <dim index="0" value="nx"/>
            </dimensions>
          </field>
          <field name="imageid" type="NX_UINT">
            <dimensions rank="1">
              <dim index="2" value="nimages"/>
            </dimensions>
            <attribute name="long_name" doc="Label for the image axis"/>
          </field>
          <field name="ypos" type="NX_NUMBER">
            <dimensions rank="1">
              <dim index="1" value="ny"/>
            </dimensions>
            <attribute name="long_name" doc="Label for the y axis"/>
          </field>
          <field name="xpos" type="NX_NUMBER">
            <dimensions rank="1">
              <dim index="0" value="nx"/>
            </dimensions>
            <attribute name="long_name" doc="Label for the x axis"/>
          </field>
        </group>
        <group type="NX_NUMBER" doc="to be defined, series_params, A collection of parameter pairs for each image, i.e. 0 or 1 + imageid * 2 implicit indexing">
          <field name="data"/>
          <dimensions rank="2">
            <dim index="1" value="nimages"/>
            <dim index="0" value="2"/>
          </dimensions>
        </group>
        <group type="NX_NUMBER" doc="A collection of alignment position quintets for each image, i.e. 0, 1, ..., 4 + imageid * 5 implicit indexing">
          <field name="data"/>
          <dimensions rank="2">
            <dim index="1" value="nimages"/>
            <dim index="0" value="5"/>
          </dimensions>
        </group>
      </group>
    </group>
    <group type="NXinstrument" minOccurs="1">
      <field name="name" doc="Name of the microscope."/>
      <field name="time_zone" type="NX_DATE_TIME" units="NX_TIME"/>
      <field name="instrument_manufacturer" doc="Manufacturer of the entire instrument to enable e.g. queries about manufacturers. Usually more technical details are needed which is why it is recommended to fill as many of the individual components of the instrument as required for interpreting the experiment."/>
      <field name="instrument_model" doc="Manufacturer brand/model to enable e.g. queries about microscope models. See comments on instrument_manufacturer on how to provide further specification."/>
      <field name="instrument_capability" doc="Free-text list of controlled EM-community vocabulary terms of functional components. If provided, compose the list from the following terms: Feg, Astar, OmegaFilter."/>
      <group type="NXsource" required="true" doc="The source creating the electron beam.">
        <field name="voltage" type="NX_FLOAT" units="NX_VOLTAGE" doc="Voltage relevant to compute the energy of the electrons immediately after they left the gun."/>
        <field name="probe">
          <enumeration>
            <item value="electron"/>
          </enumeration>
        </field>
        <field name="wavelength" type="NX_FLOAT" units="NX_WAVELENGTH" doc="to be discussed"/>
        <field name="emitter_type" doc="Emitter type used to create the beam. Choose one of the following thermionic, schottky, feg, to we need an extra one for cold-feg.">
          <enumeration>
            <item value="thermionic"/>
            <item value="schottky"/>
            <item value="feg"/>
          </enumeration>
        </field>
        <field name="description" doc="Ideally a reference to (another) file (ideally formatted using also an application definition) via a link, name, or a (globally unique) persistent identifier to give further details about the electron gun."/>
      </group>
      <field name="gun_aperture_nx_aperture"/>
      <group name="NXem_lens"/>
      <group name="NXem_lens"/>
      <group name="NXaperture"/>
      <group type="NXaperture" doc="An aperture (to be discussed or diaphragm) for the electron beam.">
        <field name="name"/>
        <field name="manufacturer_name" doc="Name of the manufacturer who built/constructed the aperture."/>
        <field name="manufacturer_model" doc="Hardware name/serial number or hash identifier given by the manufacturer to identify the aperture."/>
        <field name="description" doc="An (ideally globally unique) persistent identifier, link, or text which gives further details."/>
        <group name="NXtransformations"/>
      </group>
      <group name="NXem_cs_corr"/>
      <group name="NXem_lens"/>
      <group name="NXem_deflector"/>
      <group name="NXem_stage"/>
      <group name="NXem_lens"/>
      <group name="NXem_lens"/>
      <group name="NXaperture"/>
      <group name="NXem_lens"/>
      <group name="NXem_lens"/>
      <group name="NXem_lens"/>
      <group name="NXem_lens"/>
      <group name="NXdetector"/>
      <group name="NXaperture"/>
      <group name="NXfilter"/>
      <group name="NXem_lens"/>
      <group name="NXem_lens"/>
      <group name="NXem_lens"/>
      <group name="NXem_lens"/>
      <group name="NXdetector"/>
      <group type="NXdetector" doc="Description of the type of the detector e.g. CCD, scintillator, direct electron, image plate, CMOS">
        <field name="manufacturer_name" doc="Name of the manufacturer who built/constructed the detector"/>
        <field name="manufacturer_model" doc="Hardware name/serial number or hash identifier given by the manufacturer to identify the detector."/>
        <field name="sensor_material"/>
        <field name="bit_depth_readout" type="NX_INT"/>
        <field name="number_of_cycles" type="NX_INT"/>
        <field name="x_pixel_size" type="NX_FLOAT" units="NX_LENGTH"/>
        <field name="y_pixel_size" type="NX_FLOAT" units="NX_LENGTH"/>
        <field name="flatfield_applied" type="NX_BOOLEAN"/>
        <field name="flatfield" type="NX_FLOAT"/>
        <field name="exposure" type="NX_NUMBER" units="NX_TIME"/>
        <field name="description" doc="Free text option to write further details about the detector."/>
        <group type="NXcollection">
          <field name="darkfield_applied" type="NX_BOOLEAN" doc="to be defined, what is the idea of the darkfield here, using the camera for dark field imaging mode or is this related to eigen noise of the detector without illumination"/>
          <field name="darkfield" type="NX_FLOAT" doc="what is the idea of the darkfield here, using the camera for dark field imaging mode or is this related to inherent noise of the detector without illumination"/>
          <field name="pixel_size_x" type="NX_FLOAT" units="NX_PER_LENGTH"/>
          <field name="pixel_size_y" type="NX_FLOAT" units="NX_PER_LENGTH"/>
          <field name="cartesian_scan_dimensions" type="NX_UINT" doc="to be defined"/>
          <field name="cartesian_scan_dimension_1_count" type="NX_UINT" doc="to be defined"/>
          <field name="cartesian_scan_dimension_2_count" type="NX_UINT" doc="to be defined"/>
          <field name="cartesian_scan_dimension_3_count" type="NX_UINT" doc="to be defined"/>
          <group name="NXcollection"/>
          <field name="scan_system_name" doc="to be defined"/>
          <field name="x_points_step_width" type="NX_INT" doc="to be defined"/>
          <field name="y_points_step_width" type="NX_INT" doc="to_be_defined"/>
        </group>
      </group>
      <group name="NXdetector"/>
      <group name="NXdetector"/>
      <group name="NXdetector"/>
      <group name="NXaperture"/>
      <group name="NXdetector"/>
    </group>
  </group>
</definition>
