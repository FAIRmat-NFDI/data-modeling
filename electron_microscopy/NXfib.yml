# kuehbacm at hu-berlin.de, 01/2022
#draft for a base class which can describe all those components of an (electron) microscope which equips it with focused-ion-beam (FIB) milling capabilities. FIB is a material preparation technique whereby the sample is milled with a focused ion beam to remove material in a controlled manner. The technique enables site-specific preparation. One of the key application cases is in a scanning electron microscope / focused-ion beam instrument (SEM/FIB). The fact that a second gun and relevant control and focusing devices are needed warrants an own class.
# for more details about the relevant physics the following studies can be a start:
# https://link.springer.com/content/pdf/10.1557/s43578-020-00045-w.pdf
# https://www.sciencedirect.com/science/article/pii/S0168583X10001862
# https://www.osti.gov/servlets/purl/924801
category: base
doc: "Draft of a base class for describing focused-ion beam capabilities of an instrument. The class is designed to be used as an additional component of e.g. an electron microscope to describe sample/specimen preparation and the collecting of data and metadata for (scanning) electron microscope/focused-ion beam, (S)EM/FIB instruments."
#symbols:
#  doc: The symbols used in the schema to specify e.g. variables.
(NXfib):
  name:
    doc: "Given name."
  model:
    doc: "Given brand or model name by the manufacturer."
  serial_number:
    doc: "Given hardware name/serial number or hash identifier issued by the manufacturer."
  manufacturer_name:
    doc: "Given name of the manufacturer."
  description:
    doc: "Ideally a reference to persistent documentation which specifies further details for the device. If this is not available, add a free-text description to deliver further details about the focused-ion unit."
  ion_gun(NXsource):
    ion_source:
      doc: "The type of source which creates the ion beam."
      enumeration: ["liquid-metal", "plasma", "gas-field"]
    ionized_species:
      doc: "Which ionized elements or molecule are ionized to form the beam that sputters material. Examples a gallium, helium, neon, argon, krypton, or xenon, O2+."
    # NEW ISSUE: use NXion instead
    brightness(NX_FLOAT):
      doc: "Average/nominal (discuss further with colleagues) brightness of the ion beam (at which location?)."
      unit: NX_ANY
      # NEW ISSUE: units according to Tommaso's scheme, e.g. A/cm*sr
    flux(NX_FLOAT):
      doc: "Ion flux"
      unit: NX_FLUX
    current(NX_FLOAT):
      doc: "Charge current"
      unit: NX_CURRENT
    voltage(NX_FLOAT):
      doc: "Ion acceleration voltage upon source exit and entering the vacuum flight path."
      unit: NX_VOLTAGE
    ion_energy_profile(NX_NUMBER):
      doc: "Needs further discussion with colleagues how this should be defined."
      unit: NX_ENERGY
  (NXtransformation):
      doc: "A right-handed Cartesian coordinate system is used whose positive z-axis points in the direction of the ion beam, i.e. towards the sample. For modelling ion milling it is relevant to document the illumination vector. NXtransformations offers a place to store how the ion gun coordinate system has to be rotated to align its positive z-axis with the positive z-axis of e.g. the electron beam and ion beam respectively."
    # NEW ISSUE: once the ion beam is created we can probe the beam and document these probes with NXbeam
    # but we need electro-magnetic lenses to shape the ion beam and a scan box to sputter material in a controlled manner
    # these can be detailed though using NXlens_em, and NXscanbox_em
  (NXlens_em):
  (NXaperture):
  # all these components of the FIB system are usually controlled via an instrument control software that is often part of the e.g. microscope control software or at least linking to this software.
  # NEW ISSUE: scan_align(NXprocess):
  #   doc: "No further detailed hardware/software which illuminates the sample."
  # NEW ISSUE: milling_plan(NXprocess):
  #   doc: Description of the program and sequence of sample positions sputtered.
    #in here we can store time-dependent quantities that give further details how the
  # NEW ISSUE: column pressure
  # NEW ISSUE: detailed lens and aperture setups can be modelled like for NXem using NXlens_em, NXaperture, NXdeflector
  # NEW ISSUE: for documentation of charge compensation