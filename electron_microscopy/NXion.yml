# kuehbacm at hu-berlin.de, 01/2022
category: base
doc: "Atomic architecture of a (molecular) ion (fragment) which can be used for example to label charged molecule ions identified from mass-to-charge histogram data as appearing as signal in e.g. time-resolved mass spectrometry techniques like atom probe or secondary ion mass spectrometry."
symbols:
  doc: "The symbols used in the schema to specify e.g. dimensions of arrays."
  Nivecmax: "Maximum number of allowed atoms per (molecular) ion (fragment)."
  Nranges: "Number of mass-to-charge-state-ratio range intervals mapped on this ion type."
(NXion):
  ion_type(NX_UINT):
    # for base classes the NeXus default is that exists optional
    doc: "Ion type aka ion species identifier. The identifier zero is reserved for the special ion type unknown ion type."
    unit: NX_UNITLESS
  isotope_vector(NX_UINT):
    doc: "A vector of ordered isotope hash values. The values have to be arranged in the array in decreasing order. The array is filled with zero hash values indicating unused places. The individual hash values are built with the following hash function. Hashvalue = Z + N*256 where Z is the number of protons and N the number of neutrons of the isotope. Z and N have to be 8-bit unsigned integers for this hash function to work."
    unit: NX_UNITLESS
    dimensions:
      rank: 1
      dim: [[1, Nivecmax]]
  charge_state(NX_INT):
    doc: "Signed charge of the ion in multiples of the elementary electron charge. Only positive values will be measured in atom probe microscopy as the ions are accelerated by a negatively signed bias electric field. In the case the charge state is not recoverable explicitly, the value should be set to zero. This is for example the case when using classical range file formats (RNG, RRNG) because for atom probe microscopy these files do not document the charge state explicitly but report just a integer fraction of the theoretical mass-to-charge-state-ratios."
    unit: NX_DIMENSIONLESS
  name(NX_CHAR):
    doc: "Human-readable ion type name (e.g. Al3+), i.e. ASCII UTF-8 character array, ideally using LaTeX notation to specify the ion and charge state. Examples 12C+, Al3+ or H+. Although human-readable and intuitive, parsing such names becomes impractical for more complicated cases. Therefore, the isotope_vector is the preferred machine-readable format."
  mass_to_charge_range(NX_FLOAT):
    doc: "Lower (mqmin) and upper (mqmax) bounds of a mass-to-charge interval [mqmin, mqmax] (boundaries included) where assigned signal for the respective ion is labelled as this ion."
    unit: NX_ANY
    # NEW ISSUE: use Tommasso scheme for storing Da
    dimensions:
      rank: 2
      dim: [[1, 2], [2, Nranges]]